<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Calcolatore professionale di risonanze acustiche per stanze rettangolari. Analisi modale, visualizzazioni spettrali e esportazione risultati.">
    <meta name="keywords" content="acustica stanze, modi risonanza, onde stazionarie, elaborazione segnale acustico, design audio">
    <title>RAC | Calcolatore Risonanze Acustiche</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E🎵%3C/text%3E%3C/svg%3E">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- MathJax for LaTeX rendering -->
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- Export libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>
<div class="top-bar">
    <a href="https://nilslewin.com" class="domain-link" title="Visit nilslewin.com">
        <i class="fas fa-home"></i>
        <span>nilslewin.com</span>
    </a>
    <h1>Room Acoustics Calculator</h1>
    <button id="dark-mode-toggle" class="dark-mode-btn" aria-label="Toggle Dark Mode">
        <i class="fas fa-moon"></i>
    </button>
</div>

<div class="container" id="main-content">
    <div class="tabs">
        <button class="tab-button active" data-tab="resonance">Risonanza Armonica</button>
        <button class="tab-button" data-tab="standing-waves">Onde Stazionarie</button>
    </div>
    <details class="intro-section">
        <summary>Come funziona questo calcolatore di frequenze di risonanza</summary>
        <p>Questo calcolatore determina le frequenze di risonanza e le onde stazionarie in ambienti rettangolari, essenziale per il design di sale da concerto, studi di registrazione e spazi di ascolto. Basato sulla teoria delle onde acustiche, visualizza la distribuzione energetica dei modi modali usando tecniche di elaborazione del segnale avanzate.</p>
        <div class="usage-guide">
            <h3>Come Usare</h3>
            <ol>
                <li>Inserisci le dimensioni della stanza (L, W, H) in metri</li>
                <li>Seleziona la velocità del suono (default: aria a 20°C)</li>
                <li>Specifica il numero di modi da calcolare</li>
                <li>Esplora i grafici e le tabelle per identificare problemi di risonanza</li>
            </ol>
        </div>
    </details>
    <div class="tab-content active" id="resonance">
        <h2>Calcolo Frequenze di Risonanza</h2>
        <div class="input-form">
            <div class="dimensions-group">
                <div class="input-group dimension-input">
                    <label for="room-length">Lunghezza (m):</label>
                    <input type="number" id="room-length" step="0.01" min="0.1" value="5">
                </div>
                <div class="input-group dimension-input">
                    <label for="room-width">Larghezza (m):</label>
                    <input type="number" id="room-width" step="0.01" min="0.1" value="4">
                </div>
                <div class="input-group dimension-input">
                    <label for="room-height">Altezza (m):</label>
                    <input type="number" id="room-height" step="0.01" min="0.1" value="3">
                </div>
            </div>
            <div class="parameters-group">
                <div class="input-group dimension-input">
                    <label for="sound-speed">Velocità del suono:</label>
                    <select id="sound-speed" class="select-input">
                        <option value="343">Aria a 20°C (343 m/s)</option>
                        <option value="331">Aria a 0°C (331 m/s)</option>
                        <option value="349">Aria a 30°C (349 m/s)</option>
                        <option value="1500">Acqua (1500 m/s)</option>
                    </select>
                </div>
                <div class="input-group dimension-input">
                    <label for="max-modes">Numero di modi:</label>
                    <div class="number-input-container">
                        <button class="number-btn minus-btn" data-target="max-modes">-</button>
                        <input type="number" id="max-modes" step="1" min="1" max="10" value="5">
                        <button class="number-btn plus-btn" data-target="max-modes">+</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="results">
            <div class="visualization">
                <div class="chart-container">
                    <div class="chart-controls">
                        <label><input type="checkbox" id="show-axial" checked> <span class="color-indicator" style="background-color: var(--chart-axial);"></span> Assiale</label>
                        <label><input type="checkbox" id="show-tangential" checked> <span class="color-indicator" style="background-color: var(--chart-tangential);"></span> Tangenziale</label>
                        <label><input type="checkbox" id="show-oblique" checked> <span class="color-indicator" style="background-color: var(--chart-oblique);"></span> Obliqua</label>
                        <label><input type="checkbox" id="show-combined" checked> <span class="color-indicator" style="background-color: var(--chart-combined);"></span> Risultante</label>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="frequency-chart" height="360"></canvas>
                    </div>
                </div>
                <div class="export-controls">
                    <button id="export-pdf-btn" class="export-btn"><i class="fas fa-file-pdf"></i> Esporta PDF</button>
                    <button id="export-csv-btn" class="export-btn"><i class="fas fa-file-csv"></i> Esporta CSV</button>
                </div>
                <div class="chart-description">
                    <p><strong>Questo grafico mostra la distribuzione energetica delle frequenze di risonanza nella stanza:</strong></p>
                    <ul>
                        <li><strong style="color: var(--chart-axial);">Assiale (rosso)</strong>: modi che vibrano lungo una sola dimensione</li>
                        <li><strong style="color: var(--chart-tangential);">Tangenziale (blu)</strong>: modi che vibrano lungo due dimensioni</li>
                        <li><strong style="color: var(--chart-oblique);">Obliqua (giallo)</strong>: modi che vibrano lungo tutte e tre le dimensioni</li>
                        <li><strong style="color: var(--chart-combined);">Risultante (viola)</strong>: combinazione di tutti i modi</li>
                    </ul>
                    <p><em>L'altezza delle curve indica l'energia relativa di ogni frequenza.</em></p>
                    <button id="math-info-btn" class="math-info-button">Informazioni Matematiche</button>
                </div>
                <!-- Hidden canvas for PDF export with fixed dimensions -->
                <canvas id="pdf-chart-canvas" width="1016" height="350" style="position: absolute; left: -9999px; top: -9999px; visibility: hidden;"></canvas>
            </div>
            <h3>Risultati</h3>
            <div class="result-container">
                <div class="result-section">
                    <h4 class="header-results">Frequenze Assiali</h4>
                    <div id="axial-results" class="result-data"></div>
                </div>
                <div class="result-section">
                    <h4 class="header-results">Frequenze Tangenziali</h4>
                    <div id="tangential-results" class="result-data"></div>
                </div>
                <div class="result-section">
                    <h4 class="header-results">Frequenze Oblique</h4>
                    <div id="oblique-results" class="result-data"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="tab-content" id="standing-waves">
        <h2>Calcolo Onde Stazionarie</h2>
        <div class="input-form">
            <div class="dimensions-group">
                <div class="input-group dimension-input">
                    <label for="sw-length">Lunghezza (m):</label>
                    <input type="number" id="sw-length" step="0.01" min="0.1" value="5">
                </div>
                <div class="input-group dimension-input">
                    <label for="sw-width">Larghezza (m):</label>
                    <input type="number" id="sw-width" step="0.01" min="0.1" value="4">
                </div>
                <div class="input-group dimension-input">
                    <label for="sw-height">Altezza (m):</label>
                    <input type="number" id="sw-height" step="0.01" min="0.1" value="3">
                </div>
            </div>
            <div class="parameters-group">
                <div class="input-group dimension-input">
                    <label for="sw-sound-speed">Velocità del suono:</label>
                    <select id="sw-sound-speed" class="select-input">
                        <option value="343">Aria a 20°C (343 m/s)</option>
                        <option value="331">Aria a 0°C (331 m/s)</option>
                        <option value="346">Aria a 25°C (346 m/s)</option>
                        <option value="349">Aria a 30°C (349 m/s)</option>
                        <option value="1500">Acqua (1500 m/s)</option>
                    </select>
                </div>
                <div class="input-group dimension-input">
                    <label for="sw-max-modes">Numero di modi:</label>
                    <div class="number-input-container">
                        <button class="number-btn minus-btn" data-target="sw-max-modes">-</button>
                        <input type="number" id="sw-max-modes" step="1" min="1" max="10" value="5">
                        <button class="number-btn plus-btn" data-target="sw-max-modes">+</button>
                    </div>
                </div>
            </div>
            <!-- Pulsante di calcolo rimosso - aggiornamento automatico -->
        </div>

        <div class="results">
            <div class="visualization">
                <div class="chart-container">
                    <div class="chart-controls">
                        <label><input type="checkbox" id="show-length" checked> <span class="color-indicator" style="background-color: var(--chart-length);"></span> Lunghezza</label>
                        <label><input type="checkbox" id="show-width" checked> <span class="color-indicator" style="background-color: var(--chart-width);"></span> Larghezza</label>
                        <label><input type="checkbox" id="show-height" checked> <span class="color-indicator" style="background-color: var(--chart-height);"></span> Altezza</label>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="standing-waves-chart" height="360"></canvas>
                    </div>
                </div>
                <div class="chart-description">
                    <p><strong>Questo grafico mostra le frequenze delle onde stazionarie nella stanza:</strong></p>
                    <ul>
                        <li><strong style="color: var(--chart-length);">Lunghezza (rosso)</strong>: onde stazionarie lungo la dimensione della lunghezza</li>
                        <li><strong style="color: var(--chart-width);">Larghezza (blu)</strong>: onde stazionarie lungo la dimensione della larghezza</li>
                        <li><strong style="color: var(--chart-height);">Altezza (verde)</strong>: onde stazionarie lungo la dimensione dell'altezza</li>
                    </ul>
                    <p><em>Ogni linea verticale rappresenta una frequenza di risonanza.</em></p>
                </div>
            </div>
            <h3>Risultati</h3>
            <div class="result-container">
                <div class="result-section full-width">
                    <h4 class="header-results">Onde Stazionarie</h4>
                    <div id="standing-waves-results" class="result-data"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Math Info Modal -->
<div id="math-info-modal" class="math-modal-overlay">
    <div class="math-modal-content">
        <div class="math-modal-header">
            <h2>Metodi Matematici e Teoria dei Segnali</h2>
            <button class="math-modal-close">&times;</button>
        </div>
        <div class="math-modal-body">
            <div class="math-section">
                <h3>🔬 Introduzione alla Teoria Modale delle Stanze</h3>
                <p>Le stanze rettangolari costituiscono un sistema acustico fondamentale in cui l'onda sonora è soggetta a condizioni al contorno rigide (pressione zero alle pareti). La soluzione dell'equazione delle onde:</p>

                <div class="math-equation">
                    <strong>Equazione delle onde acustiche:</strong>
                    \[\nabla^2 p = \frac{1}{c^2} \frac{\partial^2 p}{\partial t^2}\]
                </div>

                <p>con condizioni al contorno \(p = 0\) sulle pareti, porta alla separazione delle variabili e alla definizione dei modi normali di vibrazione. La densità modale \(\rho(f)\) per frequenze elevate segue la legge:</p>

                <div class="math-equation">
                    <strong>Densità modale:</strong>
                    \[\rho(f) \approx \frac{4\pi f^2 V}{c^3}\]
                </div>

                <p>Dove \(V\) è il volume della stanza e \(c\) la velocità del suono. Questa teoria fornisce la base matematica per comprendere la risposta impulsiva e la distribuzione energetica delle frequenze di risonanza.</p>
            </div>

            <div class="math-section">
                <h3>📊 Derivazione delle Frequenze di Risonanza</h3>
                <p><strong>Separazione delle variabili:</strong> Applicando il metodo di separazione delle variabili all'equazione delle onde con condizioni al contorno rigide, otteniamo la soluzione generale per la pressione:</p>

                <div class="math-equation">
                    <strong>Funzione modale:</strong>
                    \[p_{pqr}(x,y,z,t) = \psi_{pqr}(x,y,z) \cos(\omega_{pqr} t)\]
                </div>

                <p>Dove la funzione spaziale \(\psi_{pqr}\) è data da:</p>

                <div class="math-equation">
                    <strong>Modo normale:</strong>
                    \[\psi_{pqr}(x,y,z) = \sqrt{\frac{8}{L \times W \times H}} \sin\left(\frac{p\pi x}{L}\right) \sin\left(\frac{q\pi y}{W}\right) \sin\left(\frac{r\pi z}{H}\right)\]
                </div>

                <p>E la frequenza angolare \(\omega_{pqr} = 2\pi f_{pqr}\) soddisfa:</p>

                <div class="math-equation">
                    <strong>Frequenza di risonanza:</strong>
                    \[f_{pqr} = \frac{c}{2} \sqrt{\left(\frac{p}{L}\right)^2 + \left(\frac{q}{W}\right)^2 + \left(\frac{r}{H}\right)^2}\]
                </div>

                <p>Con \(p,q,r = 0,1,2,\dots\) (eccetto la terna nulla). Questa formula rappresenta l'equazione caratteristica del sistema e determina tutti i modi normali possibili della stanza.</p>

                <p><strong>Classificazione modale:</strong> I modi si distinguono per il numero di indici non nulli:
                <ul>
                    <li><strong>Modi assiali (p≠0, q=0, r=0):</strong> Vibrazione lungo una sola dimensione</li>
                    <li><strong>Modi tangenziali (due indici ≠0):</strong> Vibrazione lungo due dimensioni</li>
                    <li><strong>Modi obliqui (tre indici ≠0):</strong> Vibrazione tridimensionale</li>
                </ul></p>
            </div>

            <div class="math-section">
                <h3>🔄 Pipeline di Elaborazione del Segnale</h3>
                <p><strong>Trasformazione discreta → continua:</strong> Le frequenze calcolate dalla formula precedente sono discrete. Per creare un grafico continuo rappresentativo dell'energia distribuita, applichiamo una convoluzione con una distribuzione di Laplace:</p>

                <div class="math-equation">
                    <strong>Profilo energetico:</strong>
                    \[A(f) = \sum_{i} A_0^{(i)} \cdot L(f - f_i)\]
                </div>

                <p>Dove \(L(f - f_i)\) è la distribuzione di Laplace centrata su \(f_i\):</p>

                <div class="math-equation">
                    <strong>Distribuzione Laplace:</strong>
                    \[L(x) = \frac{1}{2b} \exp\left(-\frac{|x|}{b}\right)\]
                </div>

                <p>Questa scelta (anziché Gaussiana tradizionale) garantisce code più strette, riducendo l'overlap tra modi vicini e preservando la natura discreta delle risonanze.</p>

                <p><strong>Normalizzazione per densità spettrale:</strong> Per evitare che bande di frequenza con alta densità modale dominino il grafico, dividiamo lo spettro in 10 bande equidistanti e applichiamo:</p>

                <div class="math-equation">
                    <strong>Fattore di bilanciamento:</strong>
                    \[N_i = \frac{1}{\sqrt{\rho_i}}\]
                </div>

                <p>Dove \(\rho_i\) è il numero di modi nella banda \(i\).</p>
            </div>

            <div class="math-section">
                <h3>⚖️ Normalizzazione Energetica e Percezione Umana</h3>
                <p><strong>Scaling energetico dei modi:</strong> L'energia immagazzinata in ciascun modo dipende dal volume effettivo di vibrazione. I fattori empirici applicati (1.0 assiale, 0.71 tangenziale, 0.58 obliquo) riflettono la distribuzione spaziale dell'energia:</p>

                <div class="math-equation">
                    <strong>Volume effettivo:</strong>
                    \[V_{eff} = \begin{cases}
                    L & \text{modo assiale} \\
                    L \times W & \text{modo tangenziale} \\
                    L \times W \times H & \text{modo obliquo}
                    \end{cases}\]
                </div>

                <p>Questi valori empirici sono derivati da misurazioni pratiche in acustica architettonica e garantiscono una rappresentazione realistica della risposta energetica della stanza.</p>

                <p><strong>Correzione percettiva:</strong> L'orecchio umano percepisce le frequenze secondo una curva di ponderazione A. Applichiamo un tapering per compensare:</p>

                <div class="math-equation">
                    <strong>Tapering percettivo:</strong>
                    \[T(f) = \max\left(0.1, \, 1 - 0.7 \times \frac{f}{f_{\max}}\right)\]
                </div>

                <p>Questo riduce artificialmente l'ampiezza delle alte frequenze per riflettere l'esperienza uditiva reale.</p>
            </div>

            <div class="math-section">
                <h3>🔄 Algoritmo di Elaborazione</h3>
                <p>Il processo completo integra fisica delle onde, elaborazione del segnale e considerazioni percettive per produrre visualizzazioni accurate e utili.</p>

                <p><strong>Sequenza implementata:</strong></p>

                <ol>
                    <li><strong>Calcolo modale:</strong> Generazione frequenze \(f_{pqr}\) per p,q,r ≤ N_max</li>
                    <li><strong>Classificazione:</strong> Identificazione tipo modo (assiale/tangenziale/obliquo)</li>
                    <li><strong>Scaling energetico:</strong> Applicazione fattori empirici per energia reale</li>
                    <li><strong>Bilanciamento spettrale:</strong> Normalizzazione per densità modale</li>
                    <li><strong>Correzione percettiva:</strong> Tapering per risposta uditiva umana</li>
                    <li><strong>Sintesi segnale:</strong> Convoluzione con Laplace per continuità</li>
                    <li><strong>Rendering:</strong> Visualizzazione con codifica colore semantica</li>
                </ol>

                <p>Questo approccio garantisce che il grafico rappresenti fedelmente sia la fisica matematica che l'esperienza acustica pratica.</p>
                <p><strong>Perché un grafico continuo?</strong> Mentre le frequenze di risonanza sono matematicamente discrete, la risposta energetica della stanza è continua. La convoluzione con distribuzioni di Laplace crea profili che riflettono l'energia distribuita attorno a ciascun modo.</p>
            </div>

            <div class="math-section">
                <h3>Considerazioni Finali</h3>
                <p><strong>Perché tutto questo lavoro?</strong> Perché l'acustica delle stanze non riguarda solo le frequenze matematiche, ma come queste interagiscono con l'orecchio umano e influenzano l'esperienza musicale.</p>

                <p><strong>Il compromesso tra precisione e usabilità:</strong> Avremmo potuto creare un grafico che mostrasse solo i punti discreti delle frequenze calcolate, ma sarebbe stato poco informativo. Invece, abbiamo scelto di creare curve continue che rappresentano l'energia relativa di ogni frequenza, rendendo il grafico molto più utile per prendere decisioni pratiche.</p>

                <p><strong>La fisica prima di tutto:</strong> Ogni passaggio del processo è guidato da considerazioni fisiche reali. Non stiamo "abbellendo" i dati, stiamo semplicemente rappresentandoli nel modo più significativo possibile per chi lavora con l'acustica.</p>
            </div>
        </div>
    </div>
</div>

<script src="js/constants.js"></script>
<script src="js/utils.js"></script>
<script src="js/calculations.js"></script>
<!-- Display modules loaded in dependency order -->
<script src="js/display/results-display.js"></script>
<script src="js/display/signal-processing.js"></script>
<script src="js/display/chart-drawing.js"></script>
<script src="js/display/table-creation.js"></script>
<script src="js/display/interactive-features.js"></script>
<script src="js/display/animation.js"></script>
<script src="js/display/helpers.js"></script>
<script src="js/display.js"></script>
<script src="js/ui.js"></script>
<script src="js/app.js"></script>

<!-- Footer -->
<footer class="site-footer">
    <div class="footer-content">
        <div class="footer-main">
            <div class="footer-brand">
                <h3>Room Acoustics Calculator</h3>
                <p>Strumento professionale per l'analisi delle risonanze acustiche</p>
            </div>
            <div class="footer-links">
                <a href="https://nilslewin.com" target="_blank" rel="noopener">
                    <i class="fas fa-external-link-alt"></i> nilslewin.com
                </a>
                <a href="https://github.com/toboko/resonance" target="_blank" rel="noopener">
                    <i class="fab fa-github"></i> Repository GitHub
                </a>
            </div>
        </div>

        <div class="footer-tech">
            <div class="tech-credits">
                <h4>Tecnologie Utilizzate</h4>
                <div class="tech-list">
                    <span class="tech-item">
                        <i class="fas fa-chart-line"></i> Chart.js
                    </span>
                    <span class="tech-item">
                        <i class="fas fa-square-root-alt"></i> MathJax
                    </span>
                    <span class="tech-item">
                        <i class="fas fa-file-pdf"></i> jsPDF
                    </span>
                    <span class="tech-item">
                        <i class="fas fa-file-csv"></i> PapaParse
                    </span>
                </div>
            </div>
        </div>

        <div class="footer-bottom">
            <div class="copyright">
                <p>&copy; 2025 Nils Lewin. Tutti i diritti riservati.</p>
            </div>
            <div class="footer-version">
                <span>v1.0.0</span>
            </div>
        </div>
    </div>
</footer>
</body>
</html>
